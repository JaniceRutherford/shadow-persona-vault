{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo10/pro10/frontend/fhevm/internal/constants.ts"],"sourcesContent":["export const SDK_CDN_URL =\n  \"https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs\";\n"],"names":[],"mappings":";;;;AAAO,MAAM,cACX","debugId":null}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo10/pro10/frontend/fhevm/internal/RelayerSDKLoader.ts"],"sourcesContent":["import { FhevmRelayerSDKType, FhevmWindowType } from \"./fhevmTypes\";\nimport { SDK_CDN_URL } from \"./constants\";\n\ntype TraceType = (message?: unknown, ...optionalParams: unknown[]) => void;\n\nexport class RelayerSDKLoader {\n  private _trace?: TraceType;\n\n  constructor(options: { trace?: TraceType }) {\n    this._trace = options.trace;\n  }\n\n  public isLoaded() {\n    if (typeof window === \"undefined\") {\n      throw new Error(\"RelayerSDKLoader: can only be used in the browser.\");\n    }\n    return isFhevmWindowType(window, this._trace);\n  }\n\n  public load(): Promise<void> {\n    console.log(\"[RelayerSDKLoader] load...\");\n    // Ensure this only runs in the browser\n    if (typeof window === \"undefined\") {\n      console.log(\"[RelayerSDKLoader] window === undefined\");\n      return Promise.reject(\n        new Error(\"RelayerSDKLoader: can only be used in the browser.\")\n      );\n    }\n\n    if (\"relayerSDK\" in window) {\n      if (!isFhevmRelayerSDKType(window.relayerSDK, this._trace)) {\n        console.log(\"[RelayerSDKLoader] window.relayerSDK === undefined\");\n        throw new Error(\"RelayerSDKLoader: Unable to load FHEVM Relayer SDK\");\n      }\n      return Promise.resolve();\n    }\n\n    return new Promise((resolve, reject) => {\n      const existingScript = document.querySelector(\n        `script[src=\"${SDK_CDN_URL}\"]`\n      );\n      if (existingScript) {\n        if (!isFhevmWindowType(window, this._trace)) {\n          reject(\n            new Error(\n              \"RelayerSDKLoader: window object does not contain a valid relayerSDK object.\"\n            )\n          );\n        }\n        resolve();\n        return;\n      }\n\n      const script = document.createElement(\"script\");\n      script.src = SDK_CDN_URL;\n      script.type = \"text/javascript\";\n      script.async = true;\n\n      script.onload = () => {\n        if (!isFhevmWindowType(window, this._trace)) {\n          console.log(\"[RelayerSDKLoader] script onload FAILED...\");\n          reject(\n            new Error(\n              `RelayerSDKLoader: Relayer SDK script has been successfully loaded from ${SDK_CDN_URL}, however, the window.relayerSDK object is invalid.`\n            )\n          );\n        }\n        resolve();\n      };\n\n      script.onerror = () => {\n        console.log(\"[RelayerSDKLoader] script onerror... \");\n        reject(\n          new Error(\n            `RelayerSDKLoader: Failed to load Relayer SDK from ${SDK_CDN_URL}`\n          )\n        );\n      };\n\n      console.log(\"[RelayerSDKLoader] add script to DOM...\");\n      document.head.appendChild(script);\n      console.log(\"[RelayerSDKLoader] script added!\")\n    });\n  }\n}\n\nfunction isFhevmRelayerSDKType(\n  o: unknown,\n  trace?: TraceType\n): o is FhevmRelayerSDKType {\n  if (typeof o === \"undefined\") {\n    trace?.(\"RelayerSDKLoader: relayerSDK is undefined\");\n    return false;\n  }\n  if (o === null) {\n    trace?.(\"RelayerSDKLoader: relayerSDK is null\");\n    return false;\n  }\n  if (typeof o !== \"object\") {\n    trace?.(\"RelayerSDKLoader: relayerSDK is not an object\");\n    return false;\n  }\n  if (!objHasProperty(o, \"initSDK\", \"function\", trace)) {\n    trace?.(\"RelayerSDKLoader: relayerSDK.initSDK is invalid\");\n    return false;\n  }\n  if (!objHasProperty(o, \"createInstance\", \"function\", trace)) {\n    trace?.(\"RelayerSDKLoader: relayerSDK.createInstance is invalid\");\n    return false;\n  }\n  if (!objHasProperty(o, \"SepoliaConfig\", \"object\", trace)) {\n    trace?.(\"RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid\");\n    return false;\n  }\n  if (\"__initialized__\" in o) {\n    if (o.__initialized__ !== true && o.__initialized__ !== false) {\n      trace?.(\"RelayerSDKLoader: relayerSDK.__initialized__ is invalid\");\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function isFhevmWindowType(\n  win: unknown,\n  trace?: TraceType\n): win is FhevmWindowType {\n  if (typeof win === \"undefined\") {\n    trace?.(\"RelayerSDKLoader: window object is undefined\");\n    return false;\n  }\n  if (win === null) {\n    trace?.(\"RelayerSDKLoader: window object is null\");\n    return false;\n  }\n  if (typeof win !== \"object\") {\n    trace?.(\"RelayerSDKLoader: window is not an object\");\n    return false;\n  }\n  if (!(\"relayerSDK\" in win)) {\n    trace?.(\"RelayerSDKLoader: window does not contain 'relayerSDK' property\");\n    return false;\n  }\n  return isFhevmRelayerSDKType(win.relayerSDK);\n}\n\nfunction objHasProperty<\n  T extends object,\n  K extends PropertyKey,\n  V extends string // \"string\", \"number\", etc.\n>(\n  obj: T,\n  propertyName: K,\n  propertyType: V,\n  trace?: TraceType\n): obj is T &\n  Record<\n    K,\n    V extends \"string\"\n      ? string\n      : V extends \"number\"\n      ? number\n      : V extends \"object\"\n      ? object\n      : V extends \"boolean\"\n      ? boolean\n      : V extends \"function\"\n      ? // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (...args: any[]) => any\n      : unknown\n  > {\n  if (!obj || typeof obj !== \"object\") {\n    return false;\n  }\n\n  if (!(propertyName in obj)) {\n    trace?.(`RelayerSDKLoader: missing ${String(propertyName)}.`);\n    return false;\n  }\n\n  const value = (obj as Record<K, unknown>)[propertyName];\n\n  if (value === null || value === undefined) {\n    trace?.(`RelayerSDKLoader: ${String(propertyName)} is null or undefined.`);\n    return false;\n  }\n\n  if (typeof value !== propertyType) {\n    trace?.(\n      `RelayerSDKLoader: ${String(propertyName)} is not a ${propertyType}.`\n    );\n    return false;\n  }\n\n  return true;\n}\n"],"names":[],"mappings":";;;;;;AACA;;AAIO,MAAM;IACH,OAAmB;IAE3B,YAAY,OAA8B,CAAE;QAC1C,IAAI,CAAC,MAAM,GAAG,QAAQ,KAAK;IAC7B;IAEO,WAAW;QAChB,wCAAmC;YACjC,MAAM,IAAI,MAAM;QAClB;QACA,OAAO,kBAAkB,QAAQ,IAAI,CAAC,MAAM;IAC9C;IAEO,OAAsB;QAC3B,QAAQ,GAAG,CAAC;QACZ,uCAAuC;QACvC,wCAAmC;YACjC,QAAQ,GAAG,CAAC;YACZ,OAAO,QAAQ,MAAM,CACnB,IAAI,MAAM;QAEd;;;IAwDF;AACF;AAEA,SAAS,sBACP,CAAU,EACV,KAAiB;IAEjB,IAAI,OAAO,MAAM,aAAa;QAC5B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,MAAM,MAAM;QACd,QAAQ;QACR,OAAO;IACT;IACA,IAAI,OAAO,MAAM,UAAU;QACzB,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,WAAW,YAAY,QAAQ;QACpD,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,kBAAkB,YAAY,QAAQ;QAC3D,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,iBAAiB,UAAU,QAAQ;QACxD,QAAQ;QACR,OAAO;IACT;IACA,IAAI,qBAAqB,GAAG;QAC1B,IAAI,EAAE,eAAe,KAAK,QAAQ,EAAE,eAAe,KAAK,OAAO;YAC7D,QAAQ;YACR,OAAO;QACT;IACF;IACA,OAAO;AACT;AAEO,SAAS,kBACd,GAAY,EACZ,KAAiB;IAEjB,IAAI,OAAO,QAAQ,aAAa;QAC9B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,QAAQ,MAAM;QAChB,QAAQ;QACR,OAAO;IACT;IACA,IAAI,OAAO,QAAQ,UAAU;QAC3B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,CAAC,gBAAgB,GAAG,GAAG;QAC1B,QAAQ;QACR,OAAO;IACT;IACA,OAAO,sBAAsB,IAAI,UAAU;AAC7C;AAEA,SAAS,eAKP,GAAM,EACN,YAAe,EACf,YAAe,EACf,KAAiB;IAiBjB,IAAI,CAAC,OAAO,OAAO,QAAQ,UAAU;QACnC,OAAO;IACT;IAEA,IAAI,CAAC,CAAC,gBAAgB,GAAG,GAAG;QAC1B,QAAQ,CAAC,0BAA0B,EAAE,OAAO,cAAc,CAAC,CAAC;QAC5D,OAAO;IACT;IAEA,MAAM,QAAQ,AAAC,GAA0B,CAAC,aAAa;IAEvD,IAAI,UAAU,QAAQ,UAAU,WAAW;QACzC,QAAQ,CAAC,kBAAkB,EAAE,OAAO,cAAc,sBAAsB,CAAC;QACzE,OAAO;IACT;IAEA,IAAI,OAAO,UAAU,cAAc;QACjC,QACE,CAAC,kBAAkB,EAAE,OAAO,cAAc,UAAU,EAAE,aAAa,CAAC,CAAC;QAEvE,OAAO;IACT;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 196, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo10/pro10/frontend/fhevm/internal/PublicKeyStorage.ts"],"sourcesContent":["import { openDB, DBSchema, IDBPDatabase } from \"idb\";\n\ntype FhevmStoredPublicKey = {\n  publicKeyId: string;\n  publicKey: Uint8Array;\n};\n\ntype FhevmStoredPublicParams = {\n  publicParamsId: string;\n  publicParams: Uint8Array;\n};\n\ninterface PublicParamsDB extends DBSchema {\n  publicKeyStore: {\n    key: string;\n    value: {\n      acl: `0x${string}`;\n      value: FhevmStoredPublicKey;\n    };\n  };\n  paramsStore: {\n    key: string;\n    value: {\n      acl: `0x${string}`;\n      value: FhevmStoredPublicParams;\n    };\n  };\n}\n\nlet __dbPromise: Promise<IDBPDatabase<PublicParamsDB>> | undefined = undefined;\n\nasync function _getDB(): Promise<IDBPDatabase<PublicParamsDB> | undefined> {\n  if (__dbPromise) {\n    return __dbPromise;\n  }\n  if (typeof window === \"undefined\") {\n    return undefined;\n  }\n  __dbPromise = openDB<PublicParamsDB>(\"fhevm\", 1, {\n    upgrade(db) {\n      if (!db.objectStoreNames.contains(\"paramsStore\")) {\n        db.createObjectStore(\"paramsStore\", { keyPath: \"acl\" });\n      }\n      if (!db.objectStoreNames.contains(\"publicKeyStore\")) {\n        db.createObjectStore(\"publicKeyStore\", { keyPath: \"acl\" });\n      }\n    },\n  });\n  return __dbPromise;\n}\n\ntype FhevmInstanceConfigPublicKey = {\n  data: Uint8Array | null;\n  id: string | null;\n};\n\ntype FhevmInstanceConfigPublicParams = {\n  \"2048\": {\n    publicParamsId: string;\n    publicParams: Uint8Array;\n  };\n};\n\nfunction assertFhevmStoredPublicKey(\n  value: unknown\n): asserts value is FhevmStoredPublicKey | null {\n  if (typeof value !== \"object\") {\n    throw new Error(`FhevmStoredPublicKey must be an object`);\n  }\n  if (value === null) {\n    return;\n  }\n  if (!(\"publicKeyId\" in value)) {\n    throw new Error(`FhevmStoredPublicKey.publicKeyId does not exist`);\n  }\n  if (typeof value.publicKeyId !== \"string\") {\n    throw new Error(`FhevmStoredPublicKey.publicKeyId must be a string`);\n  }\n  if (!(\"publicKey\" in value)) {\n    throw new Error(`FhevmStoredPublicKey.publicKey does not exist`);\n  }\n  if (!(value.publicKey instanceof Uint8Array)) {\n    throw new Error(`FhevmStoredPublicKey.publicKey must be a Uint8Array`);\n  }\n}\n\nfunction assertFhevmStoredPublicParams(\n  value: unknown\n): asserts value is FhevmStoredPublicParams | null {\n  if (typeof value !== \"object\") {\n    throw new Error(`FhevmStoredPublicParams must be an object`);\n  }\n  if (value === null) {\n    return;\n  }\n  if (!(\"publicParamsId\" in value)) {\n    throw new Error(`FhevmStoredPublicParams.publicParamsId does not exist`);\n  }\n  if (typeof value.publicParamsId !== \"string\") {\n    throw new Error(`FhevmStoredPublicParams.publicParamsId must be a string`);\n  }\n  if (!(\"publicParams\" in value)) {\n    throw new Error(`FhevmStoredPublicParams.publicParams does not exist`);\n  }\n  if (!(value.publicParams instanceof Uint8Array)) {\n    throw new Error(\n      `FhevmStoredPublicParams.publicParams must be a Uint8Array`\n    );\n  }\n}\n\nexport async function publicKeyStorageGet(aclAddress: `0x${string}`): Promise<{\n  publicKey?: FhevmInstanceConfigPublicKey;\n  publicParams: FhevmInstanceConfigPublicParams | null;\n}> {\n  const db = await _getDB();\n  if (!db) {\n    return { publicParams: null };\n  }\n\n  let storedPublicKey: FhevmStoredPublicKey | null = null;\n  try {\n    const pk = await db.get(\"publicKeyStore\", aclAddress);\n    if (pk?.value) {\n      assertFhevmStoredPublicKey(pk.value);\n      storedPublicKey = pk.value;\n    }\n  } catch {\n    //\n  }\n\n  let storedPublicParams: FhevmStoredPublicParams | null = null;\n  try {\n    const pp = await db.get(\"paramsStore\", aclAddress);\n    if (pp?.value) {\n      assertFhevmStoredPublicParams(pp.value);\n      storedPublicParams = pp.value;\n    }\n  } catch {\n    //\n  }\n\n  const publicKeyData = storedPublicKey?.publicKey;\n  const publicKeyId = storedPublicKey?.publicKeyId;\n  const publicParams = storedPublicParams\n    ? {\n        \"2048\": storedPublicParams,\n      }\n    : null;\n\n  let publicKey: FhevmInstanceConfigPublicKey | undefined = undefined;\n\n  if (publicKeyId && publicKeyData) {\n    publicKey = {\n      id: publicKeyId,\n      data: publicKeyData,\n    };\n  }\n\n  return {\n    ...(publicKey !== undefined && { publicKey }),\n    publicParams,\n  };\n}\n\nexport async function publicKeyStorageSet(\n  aclAddress: `0x${string}`,\n  publicKey: FhevmStoredPublicKey | null,\n  publicParams: FhevmStoredPublicParams | null\n) {\n  assertFhevmStoredPublicKey(publicKey);\n  assertFhevmStoredPublicParams(publicParams);\n\n  const db = await _getDB();\n  if (!db) {\n    return;\n  }\n\n  if (publicKey) {\n    await db.put(\"publicKeyStore\", { acl: aclAddress, value: publicKey });\n  }\n\n  if (publicParams) {\n    await db.put(\"paramsStore\", { acl: aclAddress, value: publicParams });\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AA6BA,IAAI,cAAiE;AAErE,eAAe;IACb,IAAI,aAAa;QACf,OAAO;IACT;IACA,wCAAmC;QACjC,OAAO;IACT;;;AAYF;AAcA,SAAS,2BACP,KAAc;IAEd,IAAI,OAAO,UAAU,UAAU;QAC7B,MAAM,IAAI,MAAM,CAAC,sCAAsC,CAAC;IAC1D;IACA,IAAI,UAAU,MAAM;QAClB;IACF;IACA,IAAI,CAAC,CAAC,iBAAiB,KAAK,GAAG;QAC7B,MAAM,IAAI,MAAM,CAAC,+CAA+C,CAAC;IACnE;IACA,IAAI,OAAO,MAAM,WAAW,KAAK,UAAU;QACzC,MAAM,IAAI,MAAM,CAAC,iDAAiD,CAAC;IACrE;IACA,IAAI,CAAC,CAAC,eAAe,KAAK,GAAG;QAC3B,MAAM,IAAI,MAAM,CAAC,6CAA6C,CAAC;IACjE;IACA,IAAI,CAAC,CAAC,MAAM,SAAS,YAAY,UAAU,GAAG;QAC5C,MAAM,IAAI,MAAM,CAAC,mDAAmD,CAAC;IACvE;AACF;AAEA,SAAS,8BACP,KAAc;IAEd,IAAI,OAAO,UAAU,UAAU;QAC7B,MAAM,IAAI,MAAM,CAAC,yCAAyC,CAAC;IAC7D;IACA,IAAI,UAAU,MAAM;QAClB;IACF;IACA,IAAI,CAAC,CAAC,oBAAoB,KAAK,GAAG;QAChC,MAAM,IAAI,MAAM,CAAC,qDAAqD,CAAC;IACzE;IACA,IAAI,OAAO,MAAM,cAAc,KAAK,UAAU;QAC5C,MAAM,IAAI,MAAM,CAAC,uDAAuD,CAAC;IAC3E;IACA,IAAI,CAAC,CAAC,kBAAkB,KAAK,GAAG;QAC9B,MAAM,IAAI,MAAM,CAAC,mDAAmD,CAAC;IACvE;IACA,IAAI,CAAC,CAAC,MAAM,YAAY,YAAY,UAAU,GAAG;QAC/C,MAAM,IAAI,MACR,CAAC,yDAAyD,CAAC;IAE/D;AACF;AAEO,eAAe,oBAAoB,UAAyB;IAIjE,MAAM,KAAK,MAAM;IACjB,IAAI,CAAC,IAAI;QACP,OAAO;YAAE,cAAc;QAAK;IAC9B;IAEA,IAAI,kBAA+C;IACnD,IAAI;QACF,MAAM,KAAK,MAAM,GAAG,GAAG,CAAC,kBAAkB;QAC1C,IAAI,IAAI,OAAO;YACb,2BAA2B,GAAG,KAAK;YACnC,kBAAkB,GAAG,KAAK;QAC5B;IACF,EAAE,OAAM;IACN,EAAE;IACJ;IAEA,IAAI,qBAAqD;IACzD,IAAI;QACF,MAAM,KAAK,MAAM,GAAG,GAAG,CAAC,eAAe;QACvC,IAAI,IAAI,OAAO;YACb,8BAA8B,GAAG,KAAK;YACtC,qBAAqB,GAAG,KAAK;QAC/B;IACF,EAAE,OAAM;IACN,EAAE;IACJ;IAEA,MAAM,gBAAgB,iBAAiB;IACvC,MAAM,cAAc,iBAAiB;IACrC,MAAM,eAAe,qBACjB;QACE,QAAQ;IACV,IACA;IAEJ,IAAI,YAAsD;IAE1D,IAAI,eAAe,eAAe;QAChC,YAAY;YACV,IAAI;YACJ,MAAM;QACR;IACF;IAEA,OAAO;QACL,GAAI,cAAc,aAAa;YAAE;QAAU,CAAC;QAC5C;IACF;AACF;AAEO,eAAe,oBACpB,UAAyB,EACzB,SAAsC,EACtC,YAA4C;IAE5C,2BAA2B;IAC3B,8BAA8B;IAE9B,MAAM,KAAK,MAAM;IACjB,IAAI,CAAC,IAAI;QACP;IACF;IAEA,IAAI,WAAW;QACb,MAAM,GAAG,GAAG,CAAC,kBAAkB;YAAE,KAAK;YAAY,OAAO;QAAU;IACrE;IAEA,IAAI,cAAc;QAChB,MAAM,GAAG,GAAG,CAAC,eAAe;YAAE,KAAK;YAAY,OAAO;QAAa;IACrE;AACF","debugId":null}},
    {"offset": {"line": 325, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo10/pro10/frontend/fhevm/internal/fhevm.ts"],"sourcesContent":["import { isAddress, Eip1193Provider, JsonRpcProvider } from \"ethers\";\nimport type {\n  FhevmInitSDKOptions,\n  FhevmInitSDKType,\n  FhevmLoadSDKType,\n  FhevmWindowType,\n} from \"./fhevmTypes\";\nimport { isFhevmWindowType, RelayerSDKLoader } from \"./RelayerSDKLoader\";\nimport { publicKeyStorageGet, publicKeyStorageSet } from \"./PublicKeyStorage\";\nimport { FhevmInstance, FhevmInstanceConfig } from \"../fhevmTypes\";\n\nexport class FhevmReactError extends Error {\n  code: string;\n  constructor(code: string, message?: string, options?: ErrorOptions) {\n    super(message, options);\n    this.code = code;\n    this.name = \"FhevmReactError\";\n  }\n}\n\nfunction throwFhevmError(\n  code: string,\n  message?: string,\n  cause?: unknown\n): never {\n  throw new FhevmReactError(code, message, cause ? { cause } : undefined);\n}\n\nconst isFhevmInitialized = (): boolean => {\n  if (!isFhevmWindowType(window, console.log)) {\n    return false;\n  }\n  return window.relayerSDK.__initialized__ === true;\n};\n\nconst fhevmLoadSDK: FhevmLoadSDKType = () => {\n  const loader = new RelayerSDKLoader({ trace: console.log });\n  return loader.load();\n};\n\nconst fhevmInitSDK: FhevmInitSDKType = async (\n  options?: FhevmInitSDKOptions\n) => {\n  if (!isFhevmWindowType(window, console.log)) {\n    throw new Error(\"window.relayerSDK is not available\");\n  }\n  const result = await window.relayerSDK.initSDK(options);\n  window.relayerSDK.__initialized__ = result;\n  if (!result) {\n    throw new Error(\"window.relayerSDK.initSDK failed.\");\n  }\n  return true;\n};\n\nfunction checkIsAddress(a: unknown): a is `0x${string}` {\n  if (typeof a !== \"string\") {\n    return false;\n  }\n  if (!isAddress(a)) {\n    return false;\n  }\n  return true;\n}\n\nexport class FhevmAbortError extends Error {\n  constructor(message = \"FHEVM operation was cancelled\") {\n    super(message);\n    this.name = \"FhevmAbortError\";\n  }\n}\n\ntype FhevmRelayerStatusType =\n  | \"sdk-loading\"\n  | \"sdk-loaded\"\n  | \"sdk-initializing\"\n  | \"sdk-initialized\"\n  | \"creating\";\n\nasync function getChainId(\n  providerOrUrl: Eip1193Provider | string\n): Promise<number> {\n  if (typeof providerOrUrl === \"string\") {\n    const provider = new JsonRpcProvider(providerOrUrl);\n    return Number((await provider.getNetwork()).chainId);\n  }\n  const chainId = await providerOrUrl.request({ method: \"eth_chainId\" });\n  return Number.parseInt(chainId as string, 16);\n}\n\nasync function getWeb3Client(rpcUrl: string) {\n  const rpc = new JsonRpcProvider(rpcUrl);\n  try {\n    const version = await rpc.send(\"web3_clientVersion\", []);\n    return version;\n  } catch (e) {\n    throwFhevmError(\n      \"WEB3_CLIENTVERSION_ERROR\",\n      `The URL ${rpcUrl} is not a Web3 node or is not reachable. Please check the endpoint.`,\n      e\n    );\n  } finally {\n    rpc.destroy();\n  }\n}\n\nasync function tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl: string): Promise<\n  | {\n      ACLAddress: `0x${string}`;\n      InputVerifierAddress: `0x${string}`;\n      KMSVerifierAddress: `0x${string}`;\n    }\n  | undefined\n> {\n  const version = await getWeb3Client(rpcUrl);\n  if (\n    typeof version !== \"string\" ||\n    !version.toLowerCase().includes(\"hardhat\")\n  ) {\n    // Not a Hardhat Node\n    return undefined;\n  }\n  try {\n    const metadata = await getFHEVMRelayerMetadata(rpcUrl);\n    if (!metadata || typeof metadata !== \"object\") {\n      return undefined;\n    }\n    if (\n      !(\n        \"ACLAddress\" in metadata &&\n        typeof metadata.ACLAddress === \"string\" &&\n        metadata.ACLAddress.startsWith(\"0x\")\n      )\n    ) {\n      return undefined;\n    }\n    if (\n      !(\n        \"InputVerifierAddress\" in metadata &&\n        typeof metadata.InputVerifierAddress === \"string\" &&\n        metadata.InputVerifierAddress.startsWith(\"0x\")\n      )\n    ) {\n      return undefined;\n    }\n    if (\n      !(\n        \"KMSVerifierAddress\" in metadata &&\n        typeof metadata.KMSVerifierAddress === \"string\" &&\n        metadata.KMSVerifierAddress.startsWith(\"0x\")\n      )\n    ) {\n      return undefined;\n    }\n    return metadata;\n  } catch {\n    // Not a FHEVM Hardhat Node\n    return undefined;\n  }\n}\n\nasync function getFHEVMRelayerMetadata(rpcUrl: string) {\n  const rpc = new JsonRpcProvider(rpcUrl);\n  try {\n    const version = await rpc.send(\"fhevm_relayer_metadata\", []);\n    return version;\n  } catch (e) {\n    throwFhevmError(\n      \"FHEVM_RELAYER_METADATA_ERROR\",\n      `The URL ${rpcUrl} is not a FHEVM Hardhat node or is not reachable. Please check the endpoint.`,\n      e\n    );\n  } finally {\n    rpc.destroy();\n  }\n}\n\ntype MockResolveResult = { isMock: true; chainId: number; rpcUrl: string };\ntype GenericResolveResult = { isMock: false; chainId: number; rpcUrl?: string };\ntype ResolveResult = MockResolveResult | GenericResolveResult;\n\nasync function resolve(\n  providerOrUrl: Eip1193Provider | string,\n  mockChains?: Record<number, string>\n): Promise<ResolveResult> {\n  // Resolve chainId\n  const chainId = await getChainId(providerOrUrl);\n\n  // Resolve rpc url\n  let rpcUrl = typeof providerOrUrl === \"string\" ? providerOrUrl : undefined;\n\n  const _mockChains: Record<number, string> = {\n    31337: \"http://localhost:8545\",\n    ...(mockChains ?? {}),\n  };\n\n  // Help Typescript solver here:\n  if (Object.hasOwn(_mockChains, chainId)) {\n    if (!rpcUrl) {\n      rpcUrl = _mockChains[chainId];\n    }\n\n    return { isMock: true, chainId, rpcUrl };\n  }\n\n  return { isMock: false, chainId, rpcUrl };\n}\n\nexport const createFhevmInstance = async (parameters: {\n  provider: Eip1193Provider | string;\n  mockChains?: Record<number, string>;\n  signal: AbortSignal;\n  onStatusChange?: (status: FhevmRelayerStatusType) => void;\n}): Promise<FhevmInstance> => {\n  const throwIfAborted = () => {\n    if (signal.aborted) throw new FhevmAbortError();\n  };\n\n  const notify = (status: FhevmRelayerStatusType) => {\n    if (onStatusChange) onStatusChange(status);\n  };\n\n  const {\n    signal,\n    onStatusChange,\n    provider: providerOrUrl,\n    mockChains,\n  } = parameters;\n\n  // Resolve chainId\n  const { isMock, rpcUrl, chainId } = await resolve(providerOrUrl, mockChains);\n\n  if (isMock) {\n    // Throws an error if cannot connect or url does not refer to a Web3 client\n    const fhevmRelayerMetadata =\n      await tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl);\n\n    if (fhevmRelayerMetadata) {\n      // fhevmRelayerMetadata is defined, which means rpcUrl refers to a FHEVM Hardhat Node\n      notify(\"creating\");\n\n      //////////////////////////////////////////////////////////////////////////\n      // \n      // WARNING!!\n      // ALWAY USE DYNAMIC IMPORT TO AVOID INCLUDING THE ENTIRE FHEVM MOCK LIB \n      // IN THE FINAL PRODUCTION BUNDLE!!\n      // \n      //////////////////////////////////////////////////////////////////////////\n      const fhevmMock = await import(\"./mock/fhevmMock\");\n      const mockInstance = await fhevmMock.fhevmMockCreateInstance({\n        rpcUrl,\n        chainId,\n        metadata: fhevmRelayerMetadata,\n      });\n\n      throwIfAborted();\n\n      return mockInstance;\n    }\n  }\n\n  throwIfAborted();\n\n  if (!isFhevmWindowType(window, console.log)) {\n    notify(\"sdk-loading\");\n\n    // throws an error if failed\n    await fhevmLoadSDK();\n    throwIfAborted();\n\n    notify(\"sdk-loaded\");\n  }\n\n  // notify that state === \"sdk-loaded\"\n\n  if (!isFhevmInitialized()) {\n    notify(\"sdk-initializing\");\n\n    // throws an error if failed\n    await fhevmInitSDK();\n    throwIfAborted();\n\n    notify(\"sdk-initialized\");\n  }\n\n  const relayerSDK = (window as unknown as FhevmWindowType).relayerSDK;\n\n  const aclAddress = relayerSDK.SepoliaConfig.aclContractAddress;\n  if (!checkIsAddress(aclAddress)) {\n    throw new Error(`Invalid address: ${aclAddress}`);\n  }\n\n  const pub = await publicKeyStorageGet(aclAddress);\n  throwIfAborted();\n\n  const config: FhevmInstanceConfig = {\n    ...relayerSDK.SepoliaConfig,\n    network: providerOrUrl,\n    publicKey: pub.publicKey,\n    publicParams: pub.publicParams,\n  };\n\n  // notify that state === \"creating\"\n  notify(\"creating\");\n\n  const instance = await relayerSDK.createInstance(config);\n\n  // Save the key even if aborted\n  await publicKeyStorageSet(\n    aclAddress,\n    instance.getPublicKey(),\n    instance.getPublicParams(2048)\n  );\n\n  throwIfAborted();\n\n  return instance;\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 549, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo10/pro10/frontend/fhevm/useFhevm.tsx"],"sourcesContent":["import { ethers } from \"ethers\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport type { FhevmInstance } from \"./fhevmTypes\";\nimport { createFhevmInstance } from \"./internal/fhevm\";\n\nfunction _assert(condition: boolean, message?: string): asserts condition {\n  if (!condition) {\n    const m = message ? `Assertion failed: ${message}` : `Assertion failed.`;\n    console.error(m);\n    throw new Error(m);\n  }\n}\n\nexport type FhevmGoState = \"idle\" | \"loading\" | \"ready\" | \"error\";\n\nexport function useFhevm(parameters: {\n  provider: string | ethers.Eip1193Provider | undefined;\n  chainId: number | undefined;\n  enabled?: boolean;\n  initialMockChains?: Readonly<Record<number, string>>;  \n}): {\n  instance: FhevmInstance | undefined;\n  refresh: () => void;\n  error: Error | undefined;\n  status: FhevmGoState;\n} {\n  const { provider, chainId, initialMockChains, enabled = true } = parameters;\n\n  const [instance, _setInstance] = useState<FhevmInstance | undefined>(\n    undefined\n  );\n  const [status, _setStatus] = useState<FhevmGoState>(\"idle\");\n  const [error, _setError] = useState<Error | undefined>(undefined);\n  const [_isRunning, _setIsRunning] = useState<boolean>(enabled);\n  const [_providerChanged, _setProviderChanged] = useState<number>(0);\n  const _abortControllerRef = useRef<AbortController | null>(null);\n  const _providerRef = useRef<string | ethers.Eip1193Provider | undefined>(\n    provider\n  );\n  const _chainIdRef = useRef<number | undefined>(chainId);\n  const _mockChainsRef = useRef<Record<number, string> | undefined>(\n    initialMockChains\n  );\n\n  const refresh = useCallback(() => {\n    // Provider or chainId has changed. Abort immediately\n    if (_abortControllerRef.current) {\n      // Make sure _providerRef.current + _chainIdRef.current are undefined during abort\n      _providerRef.current = undefined;\n      _chainIdRef.current = undefined;\n\n      _abortControllerRef.current.abort();\n      _abortControllerRef.current = null;\n    }\n\n    _providerRef.current = provider;\n    _chainIdRef.current = chainId;\n\n    // Nullify instance immediately\n    _setInstance(undefined);\n    _setError(undefined);\n    _setStatus(\"idle\");\n\n    if (provider !== undefined) {\n      // Force call main useEffect\n      _setProviderChanged((prev) => prev + 1);\n    }\n\n    // Do not modify the running flag.\n  }, [provider, chainId]);\n\n  // Merge in main useEffect!!!\n  useEffect(() => {\n    refresh();\n  }, [refresh]);\n\n  useEffect(() => {\n    _setIsRunning(enabled);\n  }, [enabled]);\n\n  // Main useEffect\n  useEffect(() => {\n    // is _providerRef.current valid here ?\n    // even if the first useEffect is rendered in the same render-cycle ?\n    if (_isRunning === false) {\n      // cancelled\n      console.log(\"cancelled\");\n      if (_abortControllerRef.current) {\n        _abortControllerRef.current.abort();\n        _abortControllerRef.current = null;\n      }\n      // May already be null if provider was changed in the previous render-cycle\n      _setInstance(undefined);\n      _setError(undefined);\n      _setStatus(\"idle\");\n      return;\n    }\n\n    if (_isRunning === true) {\n      if (_providerRef.current === undefined) {\n        // instance should be undefined\n        // this code below should be unecessary\n        _setInstance(undefined);\n        _setError(undefined);\n        _setStatus(\"idle\");\n        return;\n      }\n\n      if (!_abortControllerRef.current) {\n        _abortControllerRef.current = new AbortController();\n      }\n\n      _assert(\n        !_abortControllerRef.current.signal.aborted,\n        \"!controllerRef.current.signal.aborted\"\n      );\n\n      // Keep old instance\n      // Was set to undefined if provider changed\n      _setStatus(\"loading\");\n      _setError(undefined);\n\n      const thisSignal = _abortControllerRef.current.signal;\n      const thisProvider = _providerRef.current;\n      // Can be undefined, if so, call eth_chainId\n      const thisRpcUrlsByChainId = _mockChainsRef.current;\n\n      createFhevmInstance({\n        signal: thisSignal,\n        provider: thisProvider,\n        mockChains: thisRpcUrlsByChainId,\n        onStatusChange: (s) =>\n          console.log(`[useFhevm] createFhevmInstance status changed: ${s}`),\n      })\n        .then((i) => {\n          console.log(`[useFhevm] createFhevmInstance created!`);\n          //console.log(`completed (runId=${thisRunId})...`);\n          if (thisSignal.aborted) return;\n\n          // is there a edge case where the assert below would fail ?\n          // it's not possible to have a _providerRef modified without a prior abort\n          _assert(\n            thisProvider === _providerRef.current,\n            \"thisProvider === _providerRef.current\"\n          );\n\n          _setInstance(i);\n          _setError(undefined);\n          _setStatus(\"ready\");\n        })\n        .catch((e) => {\n          console.log(`Error Was thrown !!! error... ` + e.name);\n          if (thisSignal.aborted) return;\n\n          // it's not possible to have a _providerRef modified without a prior abort\n          _assert(\n            thisProvider === _providerRef.current,\n            \"thisProvider === _providerRef.current\"\n          );\n\n          _setInstance(undefined);\n          _setError(e);\n          _setStatus(\"error\");\n        });\n    }\n  }, [_isRunning, _providerChanged]);\n\n  return { instance, refresh, error, status };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 688, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo10/pro10/frontend/hooks/useEthersSigner.ts"],"sourcesContent":["\"use client\";\r\n\r\nimport { useMemo } from \"react\";\r\nimport { useWalletClient } from \"wagmi\";\r\nimport { BrowserProvider, JsonRpcSigner } from \"ethers\";\r\n\r\nfunction walletClientToSigner(walletClient: any): Promise<JsonRpcSigner> {\r\n  const { account, chain, transport } = walletClient;\r\n  const network = {\r\n    chainId: chain?.id,\r\n    name: chain?.name ?? \"unknown\",\r\n    ensAddress: chain?.contracts?.ensRegistry?.address,\r\n  };\r\n\r\n  const provider = new BrowserProvider(transport, network);\r\n  return provider.getSigner(account.address);\r\n}\r\n\r\nexport function useEthersSigner({ chainId }: { chainId?: number } = {}) {\r\n  const { data: walletClient } = useWalletClient({ chainId });\r\n\r\n  return useMemo(\r\n    () => (walletClient ? walletClientToSigner(walletClient) : undefined),\r\n    [walletClient]\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;AAMA,SAAS,qBAAqB,YAAiB;IAC7C,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG;IACtC,MAAM,UAAU;QACd,SAAS,OAAO;QAChB,MAAM,OAAO,QAAQ;QACrB,YAAY,OAAO,WAAW,aAAa;IAC7C;IAEA,MAAM,WAAW,IAAI,uMAAe,CAAC,WAAW;IAChD,OAAO,SAAS,SAAS,CAAC,QAAQ,OAAO;AAC3C;AAEO,SAAS,gBAAgB,EAAE,OAAO,EAAwB,GAAG,CAAC,CAAC;IACpE,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,IAAA,+LAAe,EAAC;QAAE;IAAQ;IAEzD,OAAO,IAAA,4NAAO,EACZ,IAAO,eAAe,qBAAqB,gBAAgB,WAC3D;QAAC;KAAa;AAElB","debugId":null}},
    {"offset": {"line": 721, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo10/pro10/frontend/fhevm/FhevmDecryptionSignature.ts"],"sourcesContent":["import { ethers } from \"ethers\";\nimport {\n  EIP712Type,\n  FhevmDecryptionSignatureType,\n  FhevmInstance,\n} from \"./fhevmTypes\";\nimport { GenericStringStorage } from \"./GenericStringStorage\";\n\nfunction _timestampNow(): number {\n  return Math.floor(Date.now() / 1000);\n}\n\nclass FhevmDecryptionSignatureStorageKey {\n  #contractAddresses: `0x${string}`[];\n  #userAddress: `0x${string}`;\n  #publicKey: string | undefined;\n  #key: string;\n\n  constructor(\n    instance: FhevmInstance,\n    contractAddresses: string[],\n    userAddress: string,\n    publicKey?: string\n  ) {\n    if (!ethers.isAddress(userAddress)) {\n      throw new TypeError(`Invalid address ${userAddress}`);\n    }\n\n    const sortedContractAddresses = (\n      contractAddresses as `0x${string}`[]\n    ).sort();\n\n    const emptyEIP712 = instance.createEIP712(\n      publicKey ?? ethers.ZeroAddress,\n      sortedContractAddresses,\n      0,\n      0\n    );\n\n    try {\n      const hash = ethers.TypedDataEncoder.hash(\n        emptyEIP712.domain,\n        { UserDecryptRequestVerification: emptyEIP712.types.UserDecryptRequestVerification },\n        emptyEIP712.message\n      );\n\n      this.#contractAddresses = sortedContractAddresses;\n      this.#userAddress = userAddress as `0x${string}`;\n\n      this.#key = `${userAddress}:${hash}`;\n    } catch (e) {\n      console.log(e);\n      throw e;\n    }\n  }\n\n  get contractAddresses(): `0x${string}`[] {\n    return this.#contractAddresses;\n  }\n\n  get userAddress(): `0x${string}` {\n    return this.#userAddress;\n  }\n\n  get publicKey(): string | undefined {\n    return this.#publicKey;\n  }\n\n  get key(): string {\n    return this.#key;\n  }\n}\n\nexport class FhevmDecryptionSignature {\n  #publicKey: string;\n  #privateKey: string;\n  #signature: string;\n  #startTimestamp: number; // Unix timestamp in seconds\n  #durationDays: number;\n  #userAddress: `0x${string}`;\n  #contractAddresses: `0x${string}`[];\n  #eip712: EIP712Type;\n\n  private constructor(parameters: FhevmDecryptionSignatureType) {\n    if (!FhevmDecryptionSignature.checkIs(parameters)) {\n      throw new TypeError(\"Invalid FhevmDecryptionSignatureType\");\n    }\n    this.#publicKey = parameters.publicKey;\n    this.#privateKey = parameters.privateKey;\n    this.#signature = parameters.signature;\n    this.#startTimestamp = parameters.startTimestamp;\n    this.#durationDays = parameters.durationDays;\n    this.#userAddress = parameters.userAddress;\n    this.#contractAddresses = parameters.contractAddresses;\n    this.#eip712 = parameters.eip712;\n  }\n\n  public get privateKey() {\n    return this.#privateKey;\n  }\n\n  public get publicKey() {\n    return this.#publicKey;\n  }\n\n  public get signature() {\n    return this.#signature;\n  }\n\n  public get contractAddresses() {\n    return this.#contractAddresses;\n  }\n\n  public get startTimestamp() {\n    return this.#startTimestamp;\n  }\n\n  public get durationDays() {\n    return this.#durationDays;\n  }\n\n  public get userAddress() {\n    return this.#userAddress;\n  }\n\n  static checkIs(s: unknown): s is FhevmDecryptionSignatureType {\n    if (!s || typeof s !== \"object\") {\n      return false;\n    }\n    if (!(\"publicKey\" in s && typeof s.publicKey === \"string\")) {\n      return false;\n    }\n    if (!(\"privateKey\" in s && typeof s.privateKey === \"string\")) {\n      return false;\n    }\n    if (!(\"signature\" in s && typeof s.signature === \"string\")) {\n      return false;\n    }\n    if (!(\"startTimestamp\" in s && typeof s.startTimestamp === \"number\")) {\n      return false;\n    }\n    if (!(\"durationDays\" in s && typeof s.durationDays === \"number\")) {\n      return false;\n    }\n    if (!(\"contractAddresses\" in s && Array.isArray(s.contractAddresses))) {\n      return false;\n    }\n    for (let i = 0; i < s.contractAddresses.length; ++i) {\n      if (typeof s.contractAddresses[i] !== \"string\") return false;\n      if (!s.contractAddresses[i].startsWith(\"0x\")) return false;\n    }\n    if (\n      !(\n        \"userAddress\" in s &&\n        typeof s.userAddress === \"string\" &&\n        s.userAddress.startsWith(\"0x\")\n      )\n    ) {\n      return false;\n    }\n    if (!(\"eip712\" in s && typeof s.eip712 === \"object\" && s.eip712 !== null)) {\n      return false;\n    }\n\n    // Partial type check\n    if (!(\"domain\" in s.eip712 && typeof s.eip712.domain === \"object\")) {\n      return false;\n    }\n    if (\n      !(\"primaryType\" in s.eip712 && typeof s.eip712.primaryType === \"string\")\n    ) {\n      return false;\n    }\n    if (!(\"message\" in s.eip712)) {\n      return false;\n    }\n    if (\n      !(\n        \"types\" in s.eip712 &&\n        typeof s.eip712.types === \"object\" &&\n        s.eip712.types !== null\n      )\n    ) {\n      return false;\n    }\n\n    return true;\n  }\n\n  toJSON() {\n    return {\n      publicKey: this.#publicKey,\n      privateKey: this.#privateKey,\n      signature: this.#signature,\n      startTimestamp: this.#startTimestamp,\n      durationDays: this.#durationDays,\n      userAddress: this.#userAddress,\n      contractAddresses: this.#contractAddresses,\n      eip712: this.#eip712,\n    };\n  }\n\n  static fromJSON(json: unknown) {\n    const data = typeof json === \"string\" ? JSON.parse(json) : json;\n    return new FhevmDecryptionSignature(data);\n  }\n\n  equals(s: FhevmDecryptionSignatureType) {\n    return s.signature === this.#signature;\n  }\n\n  isValid(): boolean {\n    return (\n      _timestampNow() < this.#startTimestamp + this.#durationDays * 24 * 60 * 60\n    );\n  }\n\n  async saveToGenericStringStorage(\n    storage: GenericStringStorage,\n    instance: FhevmInstance,\n    withPublicKey: boolean\n  ) {\n    try {\n      const value = JSON.stringify(this);\n\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\n        instance,\n        this.#contractAddresses,\n        this.#userAddress,\n        withPublicKey ? this.#publicKey : undefined\n      );\n      await storage.setItem(storageKey.key, value);\n      console.log(\n        `signature saved! contracts=${this.#contractAddresses.length}`\n      );\n    } catch {\n      console.error(\n        `FhevmDecryptionSignature.saveToGenericStringStorage() failed!`\n      );\n    }\n  }\n\n  static async loadFromGenericStringStorage(\n    storage: GenericStringStorage,\n    instance: FhevmInstance,\n    contractAddresses: string[],\n    userAddress: string,\n    publicKey?: string\n  ): Promise<FhevmDecryptionSignature | null> {\n    try {\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\n        instance,\n        contractAddresses,\n        userAddress,\n        publicKey\n      );\n\n      const result = await storage.getItem(storageKey.key);\n\n      if (!result) {\n        console.warn(`Could not load signature! key=${storageKey.key}`);\n        return null;\n      }\n\n      try {\n        const kps = FhevmDecryptionSignature.fromJSON(result);\n        if (!kps.isValid()) {\n          return null;\n        }\n\n        return kps;\n      } catch {\n        return null;\n      }\n    } catch {\n      console.error(\n        `FhevmDecryptionSignature.loadFromGenericStringStorage() failed!`\n      );\n      return null;\n    }\n  }\n\n  static async new(\n    instance: FhevmInstance,\n    contractAddresses: string[],\n    publicKey: string,\n    privateKey: string,\n    signer: ethers.Signer\n  ): Promise<FhevmDecryptionSignature | null> {\n    try {\n      const userAddress = (await signer.getAddress()) as `0x${string}`;\n      const startTimestamp = _timestampNow();\n      const durationDays = 365;\n      const eip712 = instance.createEIP712(\n        publicKey,\n        contractAddresses,\n        startTimestamp,\n        durationDays\n      );\n      const signature = await signer.signTypedData(\n        eip712.domain,\n        { UserDecryptRequestVerification: eip712.types.UserDecryptRequestVerification },\n        eip712.message\n      );\n      return new FhevmDecryptionSignature({\n        publicKey,\n        privateKey,\n        contractAddresses: contractAddresses as `0x${string}`[],\n        startTimestamp,\n        durationDays,\n        signature,\n        eip712: eip712 as EIP712Type,\n        userAddress,\n      });\n    } catch {\n      return null;\n    }\n  }\n\n  static async loadOrSign(\n    instance: FhevmInstance,\n    contractAddresses: string[],\n    signer: ethers.Signer,\n    storage: GenericStringStorage,\n    keyPair?: { publicKey: string; privateKey: string }\n  ): Promise<FhevmDecryptionSignature | null> {\n    const userAddress = (await signer.getAddress()) as `0x${string}`;\n\n    const cached: FhevmDecryptionSignature | null =\n      await FhevmDecryptionSignature.loadFromGenericStringStorage(\n        storage,\n        instance,\n        contractAddresses,\n        userAddress,\n        keyPair?.publicKey\n      );\n\n    if (cached) {\n      return cached;\n    }\n\n    const { publicKey, privateKey } = keyPair ?? instance.generateKeypair();\n\n    const sig = await FhevmDecryptionSignature.new(\n      instance,\n      contractAddresses,\n      publicKey,\n      privateKey,\n      signer\n    );\n\n    if (!sig) {\n      return null;\n    }\n\n    await sig.saveToGenericStringStorage(\n      storage,\n      instance,\n      Boolean(keyPair?.publicKey)\n    );\n\n    return sig;\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 952, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo10/pro10/frontend/abi/EncryptedAgeGateABI.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const EncryptedAgeGateABI = {\n  \"abi\": [\n    {\n      \"anonymous\": false,\n      \"inputs\": [\n        {\n          \"indexed\": true,\n          \"internalType\": \"address\",\n          \"name\": \"user\",\n          \"type\": \"address\"\n        },\n        {\n          \"indexed\": false,\n          \"internalType\": \"ebool\",\n          \"name\": \"encryptedIsAdult\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"name\": \"AgeSubmitted\",\n      \"type\": \"event\"\n    },\n    {\n      \"anonymous\": false,\n      \"inputs\": [\n        {\n          \"indexed\": true,\n          \"internalType\": \"address\",\n          \"name\": \"grantedBy\",\n          \"type\": \"address\"\n        },\n        {\n          \"indexed\": true,\n          \"internalType\": \"address\",\n          \"name\": \"viewer\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"StatsAccessGranted\",\n      \"type\": \"event\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"MINIMUM_ADULT_AGE\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint8\",\n          \"name\": \"\",\n          \"type\": \"uint8\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"viewer\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"allowStats\",\n      \"outputs\": [],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"getAdultSubmissions\",\n      \"outputs\": [\n        {\n          \"internalType\": \"euint32\",\n          \"name\": \"\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"user\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"getLatestAge\",\n      \"outputs\": [\n        {\n          \"internalType\": \"euint8\",\n          \"name\": \"\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"user\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"getLatestDecision\",\n      \"outputs\": [\n        {\n          \"internalType\": \"ebool\",\n          \"name\": \"\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"getMinorSubmissions\",\n      \"outputs\": [\n        {\n          \"internalType\": \"euint32\",\n          \"name\": \"\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"protocolId\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"pure\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"externalEuint8\",\n          \"name\": \"encryptedAge\",\n          \"type\": \"bytes32\"\n        },\n        {\n          \"internalType\": \"bytes\",\n          \"name\": \"inputProof\",\n          \"type\": \"bytes\"\n        }\n      ],\n      \"name\": \"submitAge\",\n      \"outputs\": [],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    }\n  ]\n} as const;\n\n"],"names":[],"mappings":"AACA;;;AAGA;;;;AACO,MAAM,sBAAsB;IACjC,OAAO;QACL;YACE,aAAa;YACb,UAAU;gBACR;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,QAAQ;QACV;QACA;YACE,aAAa;YACb,UAAU;gBACR;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,QAAQ;QACV;QACA;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW,EAAE;YACb,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW,EAAE;YACb,mBAAmB;YACnB,QAAQ;QACV;KACD;AACH","debugId":null}},
    {"offset": {"line": 1126, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo10/pro10/frontend/abi/EncryptedAgeGateAddresses.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const EncryptedAgeGateAddresses = { \n  \"11155111\": { address: \"0xefcb07c83Fd14eDA3a2134110Fc3Fe689636b1B2\", chainId: 11155111, chainName: \"sepolia\" },\n  \"31337\": { address: \"0x5FbDB2315678afecb367f032d93F642f64180aa3\", chainId: 31337, chainName: \"hardhat\" },\n};\n"],"names":[],"mappings":"AACA;;;AAGA;;;;AACO,MAAM,4BAA4B;IACvC,YAAY;QAAE,SAAS;QAA8C,SAAS;QAAU,WAAW;IAAU;IAC7G,SAAS;QAAE,SAAS;QAA8C,SAAS;QAAO,WAAW;IAAU;AACzG","debugId":null}},
    {"offset": {"line": 1149, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo10/pro10/frontend/components/AgeVerificationExperience.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport Image from \"next/image\";\r\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\r\nimport { ConnectButton } from \"@rainbow-me/rainbowkit\";\r\nimport { useAccount, useChainId, usePublicClient, useWalletClient } from \"wagmi\";\r\nimport { ethers } from \"ethers\";\r\n\r\nimport { useFhevm } from \"@/fhevm/useFhevm\";\r\nimport { useInMemoryStorage } from \"@/hooks/useInMemoryStorage\";\r\nimport { useEthersSigner } from \"@/hooks/useEthersSigner\";\r\nimport { FhevmDecryptionSignature } from \"@/fhevm/FhevmDecryptionSignature\";\r\nimport { EncryptedAgeGateABI } from \"@/abi/EncryptedAgeGateABI\";\r\nimport { EncryptedAgeGateAddresses } from \"@/abi/EncryptedAgeGateAddresses\";\r\n\r\ntype AgeGateContractInfo = {\r\n  address?: `0x${string}`;\r\n  chainId?: number;\r\n  chainName?: string;\r\n  abi: typeof EncryptedAgeGateABI.abi;\r\n};\r\n\r\nconst INITIAL_MOCK_CHAINS: Record<number, string> = {\r\n  31337: \"http://127.0.0.1:8545\",\r\n};\r\n\r\nfunction getContractInfo(chainId: number | undefined): AgeGateContractInfo {\r\n  if (!chainId) {\r\n    return { abi: EncryptedAgeGateABI.abi };\r\n  }\r\n\r\n  const entry =\r\n    EncryptedAgeGateAddresses[\r\n      chainId.toString() as keyof typeof EncryptedAgeGateAddresses\r\n    ];\r\n\r\n  if (!entry || entry.address === ethers.ZeroAddress) {\r\n    return { abi: EncryptedAgeGateABI.abi, chainId };\r\n  }\r\n\r\n  return {\r\n    abi: EncryptedAgeGateABI.abi,\r\n    address: entry.address as `0x${string}`,\r\n    chainId: entry.chainId,\r\n    chainName: entry.chainName,\r\n  };\r\n}\r\n\r\ntype Handles = {\r\n  age?: string;\r\n  decision?: string;\r\n  adults?: string;\r\n  minors?: string;\r\n};\r\n\r\ntype ClearValues = {\r\n  decision?: \"Adult\" | \"Minor\";\r\n  adults?: number;\r\n  minors?: number;\r\n};\r\n\r\nexport function AgeVerificationExperience() {\r\n  const { address, isConnected } = useAccount();\r\n  const chainId = useChainId();\r\n  const { data: walletClient } = useWalletClient({ chainId });\r\n  const publicClient = usePublicClient({ chainId });\r\n  const signerPromise = useEthersSigner({ chainId });\r\n  const { storage } = useInMemoryStorage();\r\n\r\n  const [ageInput, setAgeInput] = useState(\"21\");\r\n  const [handles, setHandles] = useState<Handles>({});\r\n  const [clearValues, setClearValues] = useState<ClearValues>({});\r\n  const [message, setMessage] = useState(\"\");\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [decrypting, setDecrypting] = useState(false);\r\n  const [decryptingStat, setDecryptingStat] = useState<\"adults\" | \"minors\" | null>(null);\r\n  const [shareAddress, setShareAddress] = useState(\"\");\r\n  const [sharing, setSharing] = useState(false);\r\n\r\n  const contract = useMemo(() => getContractInfo(chainId), [chainId]);\r\n\r\n  const {\r\n    instance,\r\n    status: fheStatus,\r\n    error: fheError,\r\n  } = useFhevm({\r\n    provider: walletClient as unknown as ethers.Eip1193Provider | undefined,\r\n    chainId,\r\n    initialMockChains: INITIAL_MOCK_CHAINS,\r\n    enabled: Boolean(walletClient),\r\n  });\r\n\r\n  const canUseContract = Boolean(contract.address);\r\n\r\n  const refreshHandles = useCallback(async () => {\r\n    if (!publicClient || !contract.address || !address) {\r\n      setHandles({});\r\n      return;\r\n    }\r\n\r\n    setRefreshing(true);\r\n    try {\r\n      const [age, decision, adultCount, minorCount] = await Promise.all([\r\n        publicClient.readContract({\r\n          address: contract.address,\r\n          abi: contract.abi,\r\n          functionName: \"getLatestAge\",\r\n          args: [address],\r\n        }),\r\n        publicClient.readContract({\r\n          address: contract.address,\r\n          abi: contract.abi,\r\n          functionName: \"getLatestDecision\",\r\n          args: [address],\r\n        }),\r\n        publicClient.readContract({\r\n          address: contract.address,\r\n          abi: contract.abi,\r\n          functionName: \"getAdultSubmissions\",\r\n        }),\r\n        publicClient.readContract({\r\n          address: contract.address,\r\n          abi: contract.abi,\r\n          functionName: \"getMinorSubmissions\",\r\n        }),\r\n      ]);\r\n\r\n      setHandles({\r\n        age: age as string,\r\n        decision: decision as string,\r\n        adults: adultCount as string,\r\n        minors: minorCount as string,\r\n      });\r\n    } catch (err) {\r\n      console.error(err);\r\n      setMessage(\"Unable to refresh encrypted state. Check your RPC connection.\");\r\n    } finally {\r\n      setRefreshing(false);\r\n    }\r\n  }, [publicClient, contract.address, contract.abi, address]);\r\n\r\n  useEffect(() => {\r\n    if (isConnected && canUseContract) {\r\n      refreshHandles();\r\n    } else {\r\n      setHandles({});\r\n      setClearValues({});\r\n    }\r\n  }, [isConnected, canUseContract, refreshHandles]);\r\n\r\n  const submitAge = useCallback(async () => {\r\n    if (!instance || !address || !contract.address || !walletClient) {\r\n      setMessage(\"Connect your wallet on a supported chain to submit.\");\r\n      return;\r\n    }\r\n\r\n    if (fheStatus !== \"ready\") {\r\n      setMessage(`FHEVM not ready (status: ${fheStatus}). Please wait...`);\r\n      if (fheError) {\r\n        setMessage(`FHEVM error: ${fheError.message}. On Sepolia, this may indicate Relayer SDK issues.`);\r\n      }\r\n      return;\r\n    }\r\n\r\n    const numericAge = Number(ageInput);\r\n    if (Number.isNaN(numericAge) || numericAge < 0 || numericAge > 120) {\r\n      setMessage(\"Provide a valid age between 0 and 120.\");\r\n      return;\r\n    }\r\n\r\n    setSubmitting(true);\r\n    setMessage(\"Encrypting age...\");\r\n    try {\r\n      const input = instance.createEncryptedInput(contract.address, address);\r\n      input.add8(numericAge);\r\n      const encrypted = await input.encrypt();\r\n      const encryptedHandle = ethers.hexlify(encrypted.handles[0]) as `0x${string}`;\r\n      const proofHex = ethers.hexlify(encrypted.inputProof) as `0x${string}`;\r\n\r\n      setMessage(\"Please confirm the transaction in MetaMask...\");\r\n      const hash = await walletClient.writeContract({\r\n        address: contract.address,\r\n        abi: contract.abi,\r\n        functionName: \"submitAge\",\r\n        args: [encryptedHandle, proofHex],\r\n        account: address,\r\n        chain: walletClient.chain,\r\n      });\r\n\r\n      setMessage(`Transaction submitted: ${hash}. Waiting for confirmation...`);\r\n      \r\n      // Wait for transaction receipt\r\n      if (publicClient) {\r\n        const receipt = await publicClient.waitForTransactionReceipt({ hash });\r\n        if (receipt.status === \"success\") {\r\n          setMessage(\"Transaction confirmed! Refreshing encrypted state...\");\r\n          // Wait a bit for state to propagate\r\n          await new Promise((resolve) => setTimeout(resolve, 3000));\r\n          \r\n          // Refresh handles multiple times to ensure state is updated\r\n          let retries = 3;\r\n          while (retries > 0) {\r\n            await refreshHandles();\r\n            await new Promise((resolve) => setTimeout(resolve, 1000));\r\n            \r\n            // Check if decision handle is now non-zero\r\n            const currentDecision = await publicClient.readContract({\r\n              address: contract.address,\r\n              abi: contract.abi,\r\n              functionName: \"getLatestDecision\",\r\n              args: [address],\r\n            });\r\n            \r\n            if (currentDecision && currentDecision !== ethers.ZeroHash && currentDecision !== \"0x0000000000000000000000000000000000000000000000000000000000000000\") {\r\n              setMessage(\"Submission confirmed. You can now decrypt.\");\r\n              break;\r\n            }\r\n            \r\n            retries--;\r\n            if (retries === 0) {\r\n              setMessage(\"Transaction confirmed but state not updated yet. Please refresh the page or try again.\");\r\n            }\r\n          }\r\n        } else {\r\n          setMessage(\"Transaction failed. Please check the transaction on block explorer and try again.\");\r\n        }\r\n      } else {\r\n        // Fallback if publicClient not available\r\n        await refreshHandles();\r\n        setMessage(\"Submission confirmed. You can now decrypt.\");\r\n      }\r\n    } catch (err: any) {\r\n      console.error(err);\r\n      if (err?.cause?.code === 4001 || err?.code === \"ACTION_REJECTED\" || err?.message?.includes(\"rejected\") || err?.message?.includes(\"denied\")) {\r\n        setMessage(\"Transaction was rejected. Please click 'Encrypt & Submit' again and approve the transaction in MetaMask.\");\r\n      } else if (err?.message?.includes(\"revert\") || err?.message?.includes(\"execution reverted\")) {\r\n        setMessage(`Contract execution failed: ${err?.shortMessage || err?.message}. On Sepolia, ensure FHEVM Relayer is properly configured.`);\r\n      } else {\r\n        setMessage(`Submission failed: ${err?.shortMessage || err?.message || \"Unknown error\"}. Check console for details.`);\r\n        if (chainId === 11155111) {\r\n          setMessage(`Sepolia submission failed. Ensure Relayer SDK is configured correctly and your wallet has Sepolia ETH.`);\r\n        }\r\n      }\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  }, [instance, address, contract.address, contract.abi, walletClient, ageInput, refreshHandles, publicClient, fheStatus, fheError, chainId]);\r\n\r\n  const decryptDecision = useCallback(async () => {\r\n    if (!instance || !handles.decision || !contract.address || !signerPromise) {\r\n      setMessage(\"Missing decision handle. Submit an age first.\");\r\n      return;\r\n    }\r\n\r\n    // Check if handle is ZeroHash (no submission yet)\r\n    if (handles.decision === ethers.ZeroHash || handles.decision === \"0x0000000000000000000000000000000000000000000000000000000000000000\") {\r\n      setMessage(\"No age submitted yet. Please submit your age first using 'Encrypt & Submit'.\");\r\n      return;\r\n    }\r\n\r\n    setDecrypting(true);\r\n    setMessage(\"Requesting FHEVM signature...\");\r\n    try {\r\n      const signer = await signerPromise;\r\n      if (!signer) {\r\n        setMessage(\"Signer unavailable.\");\r\n        return;\r\n      }\r\n\r\n      const sig = await FhevmDecryptionSignature.loadOrSign(\r\n        instance,\r\n        [contract.address],\r\n        signer,\r\n        storage\r\n      );\r\n\r\n      if (!sig) {\r\n        setMessage(\"Unable to obtain FHEVM signature.\");\r\n        return;\r\n      }\r\n\r\n      const result = await instance.userDecrypt(\r\n        [{ handle: handles.decision, contractAddress: contract.address }],\r\n        sig.privateKey,\r\n        sig.publicKey,\r\n        sig.signature,\r\n        sig.contractAddresses,\r\n        sig.userAddress,\r\n        sig.startTimestamp,\r\n        sig.durationDays\r\n      );\r\n\r\n      const raw = result[handles.decision];\r\n      const isAdult = raw && BigInt(raw) === BigInt(1);\r\n      setClearValues((prev) => ({ ...prev, decision: isAdult ? \"Adult\" : \"Minor\" }));\r\n      setMessage(\"Decision decrypted locally.\");\r\n    } catch (err) {\r\n      console.error(err);\r\n      setMessage(\"Decryption failed.\");\r\n    } finally {\r\n      setDecrypting(false);\r\n    }\r\n  }, [instance, handles.decision, contract.address, signerPromise, storage]);\r\n\r\n  const decryptStat = useCallback(\r\n    async (kind: \"adults\" | \"minors\") => {\r\n      const handle = handles[kind];\r\n      if (!instance || !handle || !contract.address || !signerPromise) {\r\n        setMessage(\"Missing encrypted statistic.\");\r\n        return;\r\n      }\r\n\r\n      setDecryptingStat(kind);\r\n      setMessage(\"Decrypting encrypted statistics...\");\r\n      try {\r\n        const signer = await signerPromise;\r\n        if (!signer) {\r\n          setMessage(\"Signer unavailable.\");\r\n          return;\r\n        }\r\n\r\n        const sig = await FhevmDecryptionSignature.loadOrSign(\r\n          instance,\r\n          [contract.address],\r\n          signer,\r\n          storage\r\n        );\r\n\r\n        if (!sig) {\r\n          setMessage(\"Unable to obtain FHEVM signature.\");\r\n          return;\r\n        }\r\n\r\n        const result = await instance.userDecrypt(\r\n          [{ handle, contractAddress: contract.address }],\r\n          sig.privateKey,\r\n          sig.publicKey,\r\n          sig.signature,\r\n          sig.contractAddresses,\r\n          sig.userAddress,\r\n          sig.startTimestamp,\r\n          sig.durationDays\r\n        );\r\n\r\n        const value = result[handle] ? Number(result[handle]) : 0;\r\n        setClearValues((prev) => ({ ...prev, [kind]: value }));\r\n        setMessage(\"Statistic decrypted locally.\");\r\n      } catch (err) {\r\n        console.error(err);\r\n        setMessage(\"Unable to decrypt statistic.\");\r\n      } finally {\r\n        setDecryptingStat(null);\r\n      }\r\n    },\r\n    [instance, handles, contract.address, signerPromise, storage]\r\n  );\r\n\r\n  const shareStats = useCallback(async () => {\r\n    if (!walletClient || !address || !contract.address) {\r\n      setMessage(\"Connect your wallet before sharing stats.\");\r\n      return;\r\n    }\r\n\r\n    if (!ethers.isAddress(shareAddress)) {\r\n      setMessage(\"Enter a valid EOA to grant stats access.\");\r\n      return;\r\n    }\r\n\r\n    const viewer = shareAddress as `0x${string}`;\r\n\r\n    setSharing(true);\r\n    setMessage(\"Please confirm the transaction in MetaMask...\");\r\n    try {\r\n      await walletClient.writeContract({\r\n        address: contract.address,\r\n        abi: contract.abi,\r\n        functionName: \"allowStats\",\r\n        args: [viewer],\r\n        account: address,\r\n        chain: walletClient.chain,\r\n      });\r\n      setMessage(`Stats can now be decrypted by ${shareAddress}.`);\r\n    } catch (err: any) {\r\n      console.error(err);\r\n      if (err?.cause?.code === 4001 || err?.code === \"ACTION_REJECTED\" || err?.message?.includes(\"rejected\") || err?.message?.includes(\"denied\")) {\r\n        setMessage(\"Transaction was rejected. Please try again and approve the transaction in MetaMask.\");\r\n      } else {\r\n        setMessage(`Failed to grant stats access: ${err?.shortMessage || err?.message || \"Unknown error\"}.`);\r\n      }\r\n    } finally {\r\n      setSharing(false);\r\n    }\r\n  }, [walletClient, address, contract.address, contract.abi, shareAddress]);\r\n\r\n  const contractStateCards = [\r\n    { label: \"Wallet\", value: address ?? \"Not connected\" },\r\n    {\r\n      label: \"Chain\",\r\n      value: contract.chainName\r\n        ? `${contract.chainName} (#${chainId ?? \"?\"})`\r\n        : chainId\r\n          ? `Unsupported (#${chainId})`\r\n          : \"Unknown\",\r\n    },\r\n    {\r\n      label: \"Contract\",\r\n      value: contract.address ?? \"No deployment for this chain\",\r\n    },\r\n    {\r\n      label: \"FHEVM\",\r\n      value: instance\r\n        ? `Ready (${fheStatus})`\r\n        : walletClient\r\n          ? `Loading (${fheStatus})`\r\n          : \"Connect wallet\",\r\n    },\r\n  ];\r\n\r\n  const PROCESS_STEPS = [\r\n    {\r\n      step: \"01\",\r\n      title: \"Encrypt\",\r\n      detail: \"Age is encrypted locally before leaving the browser.\",\r\n    },\r\n    {\r\n      step: \"02\",\r\n      title: \"Compare\",\r\n      detail: \"Smart contract checks if the ciphertext is  18 with FHE.\",\r\n    },\r\n    {\r\n      step: \"03\",\r\n      title: \"Authorize\",\r\n      detail: \"Contract self-authorizes encrypted stats for each submitter.\",\r\n    },\r\n    {\r\n      step: \"04\",\r\n      title: \"Decrypt\",\r\n      detail: \"Users decrypt their verdict or aggregated analysis options off-chain.\",\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"space-y-10\">\r\n      <header className=\"flex flex-col gap-6 rounded-3xl border border-white/10 bg-white/5 p-6 backdrop-blur\">\r\n        <div className=\"flex flex-col gap-4 md:flex-row md:items-center md:justify-between\">\r\n          <div className=\"flex flex-col gap-2\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <Image\r\n                src=\"/age-gate-mark.svg\"\r\n                alt=\"CipherGate Labs\"\r\n                width={200}\r\n                height={48}\r\n                priority\r\n                style={{ width: \"100%\", height: \"auto\" }}\r\n              />\r\n            </div>\r\n            <p className=\"text-lg text-slate-200\">\r\n              Privacy-first onboarding for regulated services. Age is validated under encryption and decrypted only\r\n              on the client, while aggregated stats stay private yet auditable.\r\n            </p>\r\n          </div>\r\n          <div className=\"self-start\">\r\n            <ConnectButton showBalance={false} />\r\n          </div>\r\n        </div>\r\n        <div className=\"grid gap-4 md:grid-cols-4\">\r\n          {contractStateCards.map((card) => (\r\n            <div key={card.label} className=\"rounded-2xl border border-white/5 bg-black/20 p-4\">\r\n              <p className=\"text-xs uppercase tracking-widest text-slate-400\">{card.label}</p>\r\n              <p className=\"mt-2 text-sm font-semibold text-white break-all\">{card.value}</p>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </header>\r\n\r\n      <section className=\"grid gap-6 lg:grid-cols-2\">\r\n        <div className=\"rounded-3xl border border-cyan-200/20 bg-white/5 p-6 backdrop-blur\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h2 className=\"text-2xl font-semibold text-white\">Submit Age (Encrypted)</h2>\r\n              <p className=\"text-sm text-slate-300\">\r\n                CipherGate only needs to know whether you are an adult. Everything else stays private.\r\n              </p>\r\n            </div>\r\n            <span className=\"rounded-full border border-cyan-300/30 bg-cyan-400/10 px-3 py-1 text-xs font-semibold text-cyan-200\">\r\n              Closed-loop MVP\r\n            </span>\r\n          </div>\r\n          <div className=\"mt-6 flex flex-col gap-4\">\r\n            <label className=\"text-sm font-medium text-slate-200\">\r\n              Your age (never sent in the clear)\r\n              <input\r\n                type=\"number\"\r\n                min={0}\r\n                max={120}\r\n                value={ageInput}\r\n                onChange={(e) => setAgeInput(e.target.value)}\r\n                className=\"mt-2 w-full rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-white focus:border-cyan-300 focus:outline-none\"\r\n                placeholder=\"21\"\r\n              />\r\n            </label>\r\n            <button\r\n              onClick={submitAge}\r\n              disabled={!canUseContract || !isConnected || submitting}\r\n              className=\"rounded-2xl bg-gradient-to-r from-cyan-400 to-blue-500 px-4 py-3 font-semibold text-black transition hover:opacity-90 disabled:cursor-not-allowed disabled:opacity-50\"\r\n            >\r\n              {submitting ? \"Submitting...\" : \"Encrypt & Submit\"}\r\n            </button>\r\n            <p className=\"text-xs text-slate-300\">\r\n              By pressing submit, you authorize the contract to grant decryption rights for your own verdict and the\r\n              encrypted stats. Nothing else is shared on-chain.\r\n            </p>\r\n          </div>\r\n          <div className=\"mt-6 rounded-2xl border border-white/10 bg-black/30 p-4\">\r\n            <p className=\"text-xs uppercase tracking-widest text-slate-400\">System message</p>\r\n            <p className=\"mt-2 text-sm text-white\">\r\n              {message || \"Waiting for interaction...\"}\r\n            </p>\r\n            {fheError && (\r\n              <p className=\"mt-2 text-xs text-rose-300\">FHEVM error: {fheError.message}</p>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"rounded-3xl border border-white/10 bg-white/5 p-6 backdrop-blur\">\r\n          <h2 className=\"text-2xl font-semibold text-white\">Encrypted Processing Timeline</h2>\r\n          <div className=\"mt-6 space-y-4\">\r\n            {PROCESS_STEPS.map((step) => (\r\n              <div key={step.step} className=\"flex gap-4 rounded-2xl border border-white/5 bg-black/30 p-4\">\r\n                <div className=\"flex h-12 w-12 items-center justify-center rounded-2xl bg-white/10 text-sm font-bold text-cyan-200\">\r\n                  {step.step}\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-sm font-semibold text-white\">{step.title}</p>\r\n                  <p className=\"text-xs text-slate-300\">{step.detail}</p>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      <section className=\"grid gap-6 lg:grid-cols-2\">\r\n        <div className=\"rounded-3xl border border-emerald-200/30 bg-emerald-400/5 p-6 backdrop-blur\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-xs uppercase tracking-widest text-emerald-200\">Personal verdict</p>\r\n              <h3 className=\"text-xl font-semibold text-white\">Encrypted Decision</h3>\r\n            </div>\r\n            <button\r\n              onClick={decryptDecision}\r\n              disabled={\r\n                !handles.decision ||\r\n                handles.decision === ethers.ZeroHash ||\r\n                handles.decision === \"0x0000000000000000000000000000000000000000000000000000000000000000\" ||\r\n                decrypting\r\n              }\r\n              className=\"rounded-2xl border border-emerald-200/60 px-4 py-2 text-sm font-semibold text-emerald-100 hover:bg-emerald-200/10 disabled:opacity-40\"\r\n            >\r\n              {decrypting\r\n                ? \"Decrypting...\"\r\n                : !handles.decision || handles.decision === ethers.ZeroHash || handles.decision === \"0x0000000000000000000000000000000000000000000000000000000000000000\"\r\n                  ? \"Submit age first\"\r\n                  : \"Decrypt Result\"}\r\n            </button>\r\n          </div>\r\n          <div className=\"mt-6 grid gap-4\">\r\n            <div className=\"rounded-2xl border border-white/10 bg-black/30 p-4\">\r\n              <p className=\"text-xs text-slate-400\">Cipher handle</p>\r\n              <p className=\"break-all text-sm text-white\">\r\n                {handles.decision ?? \"Not available yet\"}\r\n              </p>\r\n            </div>\r\n            <div className=\"rounded-2xl border border-white/10 bg-black/50 p-4\">\r\n              <p className=\"text-xs text-slate-400\">Decrypted status</p>\r\n              <p className=\"text-2xl font-semibold text-white\">\r\n                {clearValues.decision ?? \"Encrypted\"}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"rounded-3xl border border-indigo-200/30 bg-indigo-400/5 p-6 backdrop-blur\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-xs uppercase tracking-widest text-indigo-200\">Share insights</p>\r\n              <h3 className=\"text-xl font-semibold text-white\">Grant encrypted stats access</h3>\r\n            </div>\r\n          </div>\r\n          <div className=\"mt-6 space-y-4\">\r\n            <input\r\n              type=\"text\"\r\n              value={shareAddress}\r\n              onChange={(e) => setShareAddress(e.target.value)}\r\n              placeholder=\"0x... viewer wallet\"\r\n              className=\"w-full rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-white focus:border-indigo-200\"\r\n            />\r\n            <button\r\n              onClick={shareStats}\r\n              disabled={sharing || !shareAddress}\r\n              className=\"w-full rounded-2xl border border-indigo-200/60 px-4 py-2 text-sm font-semibold text-indigo-100 hover:bg-indigo-200/10 disabled:opacity-40\"\r\n            >\r\n              {sharing ? \"Granting...\" : \"Allow stats decryption\"}\r\n            </button>\r\n            <p className=\"text-xs text-slate-300\">\r\n              Use this option when an ops wallet needs to decrypt the aggregate counters without resubmitting an age.\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      <section className=\"rounded-3xl border border-white/10 bg-white/5 p-6 backdrop-blur\">\r\n        <div className=\"flex flex-col gap-3 md:flex-row md:items-center md:justify-between\">\r\n          <div>\r\n            <p className=\"text-xs uppercase tracking-widest text-slate-400\">Encrypted analysis options</p>\r\n            <h3 className=\"text-2xl font-semibold text-white\">Adult vs. Minor statistics</h3>\r\n          </div>\r\n          <button\r\n            onClick={refreshHandles}\r\n            disabled={refreshing}\r\n            className=\"rounded-2xl border border-white/20 px-4 py-2 text-sm font-semibold text-white hover:bg-white/10 disabled:opacity-40\"\r\n          >\r\n            {refreshing ? \"Refreshing...\" : \"Refresh handles\"}\r\n          </button>\r\n        </div>\r\n        <div className=\"mt-6 grid gap-6 md:grid-cols-2\">\r\n          {([\"adults\", \"minors\"] as Array<\"adults\" | \"minors\">).map((kind) => (\r\n            <div key={kind} className=\"rounded-2xl border border-white/10 bg-black/30 p-5\">\r\n              <p className=\"text-xs text-slate-400\">\r\n                {kind === \"adults\" ? \"Adult submissions\" : \"Minor submissions\"}\r\n              </p>\r\n              <p className=\"mt-2 text-sm text-white break-all\">\r\n                {handles[kind] ?? \"0x0\"}\r\n              </p>\r\n              <div className=\"mt-4 flex items-center justify-between\">\r\n                <p className=\"text-3xl font-semibold text-white\">\r\n                  {clearValues[kind] ?? \"Encrypted\"}\r\n                </p>\r\n                <button\r\n                  onClick={() => decryptStat(kind)}\r\n                  disabled={!handles[kind] || decryptingStat === kind}\r\n                  className=\"rounded-2xl border border-white/20 px-3 py-2 text-xs font-semibold uppercase tracking-widest text-white hover:bg-white/10 disabled:opacity-40\"\r\n                >\r\n                  {decryptingStat === kind ? \"Decrypting...\" : \"Decrypt\"}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </section>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}}]
}